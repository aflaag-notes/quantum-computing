\chapter{Quantum circuits}

So far, we have treated quantum gates primarily as \curlyquotes{abstract} unitary operators acting on quantum states. While this perspective is sufficient to define quantum algorithms and reason about their correctness, it leaves an important question unanswered: how are these gates \tit{actually} constructed? In other words, given a desired unitary transformation, how can it be realized using a finite set of elementary operations that a quantum computer can physically implement? The central result of this chapter shows that any controlled single-qubit unitary can be constructed using only a restricted set of \tit{single-qubit gates}, and a small number of CNOT gate.

Together with the Pauli matrices and the Hadamard gate, we shall introduce 2 additional quantum gates that will play a large part in this chapter, namely the \tbf{S gate} and the \tbf{T gate}: $$S := \rmat{1 & 0 \\ 0 & i} \quad \quad T := \rmat{1 & 0 \\ 0 & \exp(i \pi/4)}$$ The $S$ gate is usually called \tbf{phase gate}, while the $T$ gate is sometimes called the \tbf{$\pi/8$ gate} for historical reasons (even if $\pi/4$ is the fraction that appears in its definition).

\begin{framedprop}{}
	It holds that $S = T^2$.
\end{framedprop}

In this chapter, we will see \tit{any} arbitrary quantum computation can be reduced to a combination of

\begin{itemize}
	\item the Hadamard $H$, $S$ and $T$ gates
	\item the CNOT gate
\end{itemize}

The importance of this result stems from the fact that these gates can be physically realized, and can therefore be treated as the \tit{building blocks} of any other unitary transformation. We will discuss we this set of gates is both \tit{necessary} and \tit{sufficient} to achieve \tbf{quantum approximate universality} to arbitrary accuracy --- unfortunately, it is not known if we can achieve exact universality avoiding an exponential number of gates in the general case.

\section{Pauli gates}

In the first section of this chapter we will discuss the necessity of Pauli matrices. But first, we need to present a new type of matrices, the \tbf{rotation operators} which apply rotations on the $x$, $y$ and $z$ axes.

\begin{frameddefn}{Rotation operators}
	The \tbf{rotation operators} $R_i(\theta)$ that apply a rotation of an angle $\theta$ on the $i$-th axis (for $i \in \{x, y, z\}$) are defined as follows:
	\begin{equation*}
		\begin{alignedat}{2}
			R_x(\theta) & := \rmat{\cos \tfrac{\theta}{2} & -i \sin \tfrac{\theta}{2} \\ -i \sin \tfrac{\theta}{2} & \cos \tfrac{\theta}{2}} & \equiv e^{-i \theta X/2} \\
			R_y(\theta) & := \rmat{\cos \tfrac{\theta}{2} & - \sin \tfrac{\theta}{2}  \\ \sin \tfrac{\theta}{2} & \cos \tfrac{\theta}{2}} & \equiv e^{-i \theta Y /2} \\
			R_z(\theta) & := \rmat{e^{-i \theta / 2}      & 0                         \\ 0 & e^{i \theta / 2}} & \equiv e^{-i \theta Z/2}
		\end{alignedat}
	\end{equation*}
\end{frameddefn}

\begin{framedlem}[label={e lemma}]{}
	For any real nubmer $k \in \R$ and matrix $A$ such that $A^2 = I$, it holds that $$e^{i Ak} = \cos(k) I + i \sin(k) A$$
\end{framedlem}

\begin{proof}
	TODO \todo{TODO?}
\end{proof}

\begin{framedcor}{}
	The rotation operators can be rewritten through the Pauli gates as follows:
	\begin{equation*}
		\begin{split}
			R_x(\theta) & = \cos \dfrac{\theta}{2} I - i \sin \dfrac{\theta}{2} X \\
			R_y(\theta) & = \cos \dfrac{\theta}{2} I - i \sin \dfrac{\theta}{2} Y \\
			R_z(\theta) & = \cos \dfrac{\theta}{2} I - i \sin \dfrac{\theta}{2} Z \\
		\end{split}
	\end{equation*}
\end{framedcor}

Most importantly, the corollary above already implies that any type of rotation can be expressed in terms of only \tbf{linear combinations of Pauli matrices}.
However, there is a catch: the rotation matrices written in these form are \tit{not} constructible in practice. In the first part of this chapter we will not address this issue, and we will assume that we can construct rotation matrices of arbitrary angles. Then, in the second part of of our discussion we will discuss physical realizability of the ideas we will present.

Nevertheless, the above result together with the next theorem allow us to express \tit{any} arbitrary single-qubit operation in terms of Pauli matrices only.

\begin{framedthm}[label={zy}]{$Z$-$Y$ single-qubit decomposition}
	If $U$ is a unitary operation on a single-qubit, there exist $\alpha, \beta, \gamma, \delta \in \R$ such that $$U = e^{i \alpha} R_z(\beta) R_y(\gamma)R_z(\delta)$$
\end{framedthm}

\begin{proof}[Proof sketch.]
	Since $U$ is unitary, by \cref{rows cols unit} we know that its rows and columns must be orthonormal. This property implies the existence of real numbers $\alpha, \beta, \gamma, \delta \in \R$ such that \todo{HOW????} $$U= \rmat{e^{i (\alpha - \beta /2 - \delta/2)} \cos \tfrac{\gamma}{2} & - e^{i (\alpha - \beta/2 + \delta/2)} \sin \tfrac{\gamma}{2} \\ e^{i (\alpha + \beta / 2 - \delta / 2)} \sin \tfrac{\gamma}{2} & e^{i (\alpha + \beta / 2 + \delta/2)} \cos \tfrac{\gamma}{2}}$$ Lastly, this formulation can be rewritten as the statement describes.
\end{proof}

This theorem already shows how much we can achieve through Pauli matrices alone. However, as we already encountered multiple times throughout our discussion, we know that this is not general enough. Indeed, what we are still missing is \tbf{controlled operations}. For instance, consider the controlled NOT, the CNOT operator; even if the CNOT is a \tit{unitary transformation}, it acts on 2 qubits, which means that we cannot apply the theorem above. We observe that this problem already hints at reason why we included the CNOT in the discussion at the beginning of this chapter --- akeen eye might have also noticed that without the CNOT we don't know how to create EPR pairs! We will see how to solve these problems in the next section.

\section{Controlled operators}

\subsection{Single-qubit conditioning}

In \cref{qpe section} we showed how any single-qubit operator $U$ can be turned into a controlled operator for a single-qubit as follows: $$\mbox{C-}U = \ket 0 \bra 0 \otimes I + \ket 1 \bra 1 \otimes U$$ However, we cannot turn this controlled operator directly into a quantum gate. This formulation tells us how C-$U$ \tit{looks like} in a matrix form, but what does the actual gate look like?

Before we progress, we must first prove a corollary of the \nameref{zy}.

\begin{framedcor}{}
	If $U$ is a unitary operation on a single-qubit, there exist unitary operators $A$, $B$ and $C$ on a single-qubit such that $ABC = I$ and $$U = e^{i \alpha} AXBXC$$ where $\alpha$ is some overall phase factor.
\end{framedcor}

\begin{proof}
	Consider the real values $\alpha, \beta, \gamma$ and $\delta$ obtained from the previous theorem, and define the following operators

	\begin{itemize}
		\item $A := R_z(\beta) R_y \rbk{\tfrac{\gamma}{2}}$
		\item $B := R_y \rbk{-\tfrac{\gamma}{2}} R_z \rbk{-\tfrac{\delta + \beta}{2}}$
		\item $C := R_z \rbk{\tfrac{\delta - \beta}{2}}$
	\end{itemize}

	Proving that $ABC = I$ is left as an exercise.

	\claim{
		$XBX = R_y(\tfrac{\gamma}{2}) R_z(\tfrac{\delta + \beta}{2})$.
	}{
		By the properties of Pauli matrices, we know that

		\begin{itemize}
			\item $X^2 = I$
			\item $XYX = -Y$
			\item $XZX = -Z$
		\end{itemize}

		from which it follows that
		\begin{equation*}
			\begin{alignedat}{2}
				X B X & = X \Big( R_y(-\tfrac{\gamma}{2}) R_z(-\tfrac{\delta - \beta}{2}) \Big) X                                                                                                                                 \\
				      & = X R_y(-\tfrac{\gamma}{2}) X \, X R_z(-\tfrac{\delta - \beta}{2}) X                                                                                             & \quad \quad (X^2 = I )                 \\
				      & = \big( \cos(\tfrac{\gamma}{2}) I + i \sin(\tfrac{\gamma}{2}) X Y X \big)\big( \cos(\tfrac{\delta - \beta}{2}) I + i \sin(\tfrac{\delta - \beta}{2}) X Z X \big) & \quad \quad (\mbox{by \cref{e lemma}}) \\
				      & = \big( \cos(\tfrac{\gamma}{2}) I + i \sin(\tfrac{\gamma}{2}) (-Y) \big) \big( \cos(\tfrac{\delta - \beta}{2}) I + i \sin(\tfrac{\delta - \beta}{2}) (-Z) \big)  &                                        \\
				      & = \big( \cos(\tfrac{\gamma}{2}) I - i \sin(\tfrac{\gamma}{2}) Y \big) \big( \cos(\tfrac{\delta - \beta}{2}) I - i \sin(\tfrac{\delta - \beta}{2}) Z \big)        &                                        \\
				      & = R_y(\tfrac{\gamma}{2}) R_z(\tfrac{\delta + \beta}{2})                                                                                                          & \quad \quad (\mbox{by \cref{e lemma}}) \\
			\end{alignedat}
		\end{equation*}
	}

	From this claim, it immediately follows that
	\begin{equation*}
		\begin{split}
			e^{i \alpha}AXBXC & = e^{i \alpha} \cdot R_z (\beta) R_y \rbk{\tfrac{\gamma}{2}} R_z \rbk{\tfrac{\delta + \beta}{2}} R_z \rbk{\tfrac{\delta - \beta}{2}} \\
			                  & = e^{i \alpha} R_z(\beta) R_y(\gamma) R_z (\delta)                                                                                   \\
			                  & = U
		\end{split}
	\end{equation*}
	which concludes the proof.
\end{proof}

Now, given any unitary transformation $U$, our next goal is to understand how to implement C-$U$ using only single-qubit operations and the CNOT gate, leveraging the result above. Consider two qubits $q_0$ and $q_1$, and construct the operators $A$, $B$ and $C$ as described by the corollary. Suppose that $q_0$ is the control qubit; then, the controlled-$U$ operator should then work as follows:

\begin{itemize}
	\item if $q_0$ is not set, $q_1$ must be left unchanged
	\item if $q_0$ is set, we must apply $U$ to $q_1$
\end{itemize}

In the first case, we can leverage the fact that $A$, $B$ and $C$ satisfy $$ABC = I$$ by the corollary, indeed the following circuit is already enough to construct C-$U$:

\begin{figure}[H]
	\[
		\Qcircuit @C=2.5em @R=2.5em {
		& \lstick{q_0}    & \qw       & \ctrl{1} & \qw      & \ctrl{1} &  \qw & \ctrl{1} & \qw \\
		& \lstick{q_1}    & \gate{C}  & \targ    & \gate{B} & \targ & \gate{A} & \gate{\rmat{e^{i \alpha} & 0 \\ 0 & e^{ i \alpha}}} & \qw      \\
		}
	\]
	% \caption{The circuit.}
\end{figure}

Since $U = e^ {i \alpha} AXBXC$ by the corollary, we get that:

\begin{itemize}
	\item if $q_0$ is not set, we apply $ABC = I$ to $q_1$
	\item if $q_0$ is set, we apply $e^{i\alpha} I AXBXC =U$ to $q_1$
\end{itemize}

However, the controlled application of $e^{\alpha} I$ is \tit{not} a gate that we can use, since we want to only use CNOT's as controlled gates. Nevertheless, we can rewrite the controlled operator as follows
\begin{equation*}
	\begin{split}
		\ket 0 \bra 0 \otimes I + \ket 1 \bra 1 \otimes e^{i \alpha} I & = (\ket 0 \bra 0 + \ket 1 \bra 1 \otimes e^{i \alpha}) \otimes I     \\
		                                                               & = \rbk{\rmat{1                                                   & 0 \\ 0 & 0 } + \rmat{0 & 0 \\ 0 & e^{i \alpha}}}\otimes I  \\
		                                                               & = \rmat{1                                                        & 0 \\ 0 & e^{i \alpha}} \otimes I
	\end{split}
\end{equation*}
which means that the circuit can be rewritten as follows:

\begin{figure}[H]
	\[
		\Qcircuit @C=2.5em @R=2.5em {
		& \lstick{q_0}    & \qw       & \ctrl{1} & \qw      & \ctrl{1} &  \qw & \gate{\rmat{1 & 0 \\ 0 & e^{ i \alpha}}} & \qw \\
		& \lstick{q_1}    & \gate{C}  & \targ    & \gate{B} & \targ & \gate{A} & \qw & \qw      \\
		}
	\]
	\caption{The circuit for the controlled-$U$ operator.}
\end{figure}

Finally, the matrix obtained as a transformation for $q_0$ can be rewritten as $$\rmat{1 & 0 \\ 0 & e^{i\alpha}} = e^{i \alpha/2} R_z(\alpha$$

\subsection{Multi-qubit conditioning} \label{toffoli section}

Now that we know how to condition the application of a single-qubit operator on one qubit, what about conditioning on \tit{multiple} qubits? Given a unitary operator $U$ acting on $k$ qubits, we define the controlled operator $C^n(U)$ as follows $$C^n(U) \ket x \ket \psi = \ket x U^{x_1 \ldots x_n} \ket \psi$$ where

\begin{itemize}
	\item $\ket x$ is an $n$-qubit state
	\item $x_1$ through $x_n$ are the \tit{control} qubits of the operator
	\item $x_1, \ldots, x_n$ in the exponent of $U$ means the \tit{product} of the bits $x_1 \cdot \ldots \cdot x_n$, indeed we want to apply $U$ on $\ket \psi$ only if \tit{all} the bits of $\ket x$ are set
\end{itemize}

For now, let's restrict our focus on an easy example: suppose that $U$ is a single-qubit operator, and we want to construct $C^2(U)$, depicted below

\begin{figure}[H]
	\[
		\Qcircuit @C=2.5em @R=2.5em {
		& \lstick{q_0}    & \ctrl{2}  & \qw \\
		& \lstick{q_1}    & \ctrl{1}  & \qw \\
		& \lstick{q_2}    & \gate{U}     & \qw \\
		}
	\]
	% \caption{The circuit for the controlled-$U$ operator.}
\end{figure}

Even if we will not prove the following result, we can use this powerful property to construct a circuit as shown that computes $C^2(U)$.

\begin{framedprop}{}
	Every untary operator has a unitary square root.
\end{framedprop}

This property implies that there exists an operator $V$ such that $$V^2 = U$$ and since it is unitary, it can be used as a gate in a quantum circuit.

\begin{figure}[H]
	\[
		\Qcircuit @C=2.5em @R=2.5em {
		& \lstick{q_0} & \qw      & \ctrl{1} & \qw           & \ctrl{1} & \ctrl{2} & \qw \\
		& \lstick{q_1} & \ctrl{1} & \targ    & \ctrl{1}      & \targ    & \qw & \qw \\
		& \lstick{q_2} & \gate{V} & \qw      & \gate{V^\dag} & \qw      & \gate{V} & \qw \\
		}
	\]
	\caption{The quantum circuit that computes $C^2(U)$.}
\end{figure}

We see that this circuit computes $C^2(U)$ through the following table.

\begin{center}
	\begin{tabular}{c|c||c|l|l}
		\hline
		$q_0^i$   & $q_1^i$  & $q_0^o$  & $q_1^o$               & $q_2^o$                      \\
		\hline\hline
		$\ket 0 $ & $\ket 0$ & $\ket 0$ & $\ket 0$              & $q_2$                        \\
		$\ket 1 $ & $\ket 0$ & $\ket 1$ & $XX \ket 0 = \ket 0$  & $VV^\dag q_2 = I q_2 = q_2$  \\
		$\ket 0$  & $\ket 1$ & $\ket 0$ & $\ket 1$              & $V^\dag V q_2 = I q_2 = q_2$ \\
		$\ket 1$  & $\ket 1$ & $\ket 1$ & $X X \ket 1 = \ket 1$ & $VV q_2 = V^2 q_2 = U q_2$   \\
		\hline
	\end{tabular}

\end{center}

This seeminly uninteresting quantum circuit is actually \tit{very important}. What happens when $U = X$? It can be proven that $$V = \dfrac{(1 - i)(I + iX)}{2}$$ is such that $V^2 = X = U$. This quantum gate depicted below

\begin{figure}[H]
	\[
		\Qcircuit @C=2.5em @R=2.5em {
		& \lstick{q_0}    & \ctrl{2}  & \qw \\
		& \lstick{q_1}    & \ctrl{1}  & \qw \\
		& \lstick{q_2}    & \targ     & \qw \\
		}
	\]
	\caption{The quantum Toffoli gate.}
\end{figure}

is called \tbf{quantum Toffoli gate}, and as the name suggests there is also a classical Toffoli gate that computes exactly as we would expect: $$\funcmap{T}{\{0, 1\}^3}{\{0, 1\}^3}{(a, b, c)}{(a, b, c \oplus (a \land b))}$$ We see that this binary function flips $c$ only if both $a$ and $b$ are set to 1, since $$\lnot c = c \oplus 1$$ First, we shall show how the quantum Toffoli can be constructed using only the gates we allowed ourselves at the beginning of the chapter:

\begin{figure}[H]
	\[
		\Qcircuit @C=1em @R=1em {
		& \lstick{q_0} & \qw & \qw & \qw & \ctrl{2} & \qw & \qw & \qw & \ctrl{2} & \qw & \ctrl{1} & \qw & \ctrl{1} & \gate{T} & \qw \\
		& \lstick{q_1} & \qw & \ctrl{1} & \qw & \qw & \qw & \ctrl{1} & \qw & \qw & \gate{T^\dag} & \targ & \gate{T^\dag} & \targ & \gate{S} & \qw \\
		& \lstick{q_2} & \gate{H} & \targ & \gate{T^\dag} & \targ & \gate{T} & \targ & \gate{T^\dag} & \targ & \gate{T} & \gate{H} & \qw & \qw & \qw & \qw \\
		}
	\]
	\label{quantum toffoli}
	\caption{The quantum Toffoli gate written with only $H$, $S$, $T$ and CNOT gates.}
\end{figure}

Note that the label $T$ in this diagram represents the $T$ gate $$T = \rmat{1 & 0 \\ 0 & e^{i \pi/4}}$$ not the Toffoli gate! We will leave the correctness of this quantum circuit as an exercise for the reader.

Surprisingly, we can utilize the quantum Toffoli gate to construct $C^n(U)$. The idea is to simply chain multiple quantum Toffoli gates in order to enforce that all the control qubits are set. To achieve this, we need an overhead of $n - 1$ work qubits set to $\ket 0$, as shown below.

\begin{figure}[H]
	\[
		\Qcircuit @C=2.5em @R=2.5em {
		& \lstick{\ket{c_1}}    & \ctrl{1} & \qw & \qw & \qw & \qw & \qw & \qw & \qw & \ctrl{1} & \qw \\
		& \lstick{\ket{c_2}}    & \ctrl{4} & \qw & \qw & \qw & \qw & \qw & \qw & \qw &  \ctrl{4} & \qw \\
		& \lstick{\ket{c_3}}    & \qw & \ctrl{3} & \qw & \qw & \qw & \qw & \qw & \ctrl{3} & \qw & \qw \\
		& \lstick{\ket{c_4}}    & \qw & \qw & \ctrl{3} & \qw & \qw & \qw  & \ctrl{3} & \qw  & \qw & \qw \\
		& \lstick{\ket{c_5}}    & \qw & \qw & \qw & \ctrl{3} & \qw  & \ctrl{3} & \qw & \qw  & \qw & \qw \\
		& \lstick{\ket 0} & \targ & \ctrl{1} & \qw & \qw & \qw & \qw & \qw & \ctrl{1} & \targ & \qw \\
		& \lstick{\ket 0} & \qw & \targ & \ctrl{1} & \qw & \qw & \qw & \ctrl{1} & \targ & \qw & \qw \\
		& \lstick{\ket 0} & \qw & \qw & \targ & \ctrl{1} & \qw & \ctrl{1} & \targ & \qw & \qw & \qw \\
		& \lstick{\ket 0} & \qw & \qw & \qw & \targ & \ctrl{1} & \targ & \qw & \qw & \qw & \qw \\
		& \lstick{q_0} & \qw & \qw & \qw & \qw & \gate{U} & \qw & \qw & \qw & \qw & \qw \\
		}
	\]
	\caption{A quantum circuit implementing $C^n(U)$, with $n = 5$.}
\end{figure}

This circuit can be fully constructed with our restrictions, since it only uses quantum Toffoli gates and a single-control single-qubit $U$ gate.

As a final note, it can be proven that this idea can be extended such that any unitary operator $U$ acting on an arbitrary number of qubits can be \todo{is this even true?}

\section{Universality}

Now that we have introduced the Toffoli gate in the \tit{quantum context}, it's a good opportunity to look at what the Toffoli gate can do in classical computing, and why it's actually special even in the \tbf{classical context}.

We already mentioned how quantum computation is \tbf{reversible}, since each operator is unitary. However, we also metioned that classical computaion admits reversible computation as well. It turns out that the Toffoli gate allows such goal. Indeed, we observe that by associativity of the XOR it holds that $$(c \oplus (a \land b)) \oplus (a \land b) = c \oplus (a \land b) \oplus (a \land b) = c$$ which directly implies that $$T^2 = I \implies T = T^{-1}$$ This means that the Toffoli gate is completely invertible, and it is its own inverse.

But the Toffoli gate is not only special because it enables reversible classical computation. Indeed, above all its most important property is that it is \tbf{universal}.

\begin{framedprop}{Universality of the Toffoli gate}
	The Toffoli gate is universal.
\end{framedprop}

\begin{proof}
	Since it is well known that the NAND gate is univesal, we just need to simulate the NOT and the AND operators with the Toffoli gate. Then, if we denote with $T_3(a, b, c)$ the third output of the Toffoli gate, we get that

	\begin{itemize}
		\item the NOT gate can be simulated as follows: $$\forall x \in \B \quad T_3(1, 1, x) = x \oplus (1 \land 1) = x \oplus 1 = \lnot x$$
		\item the AND gate can be simulated as follows: $$\forall x, y \in \B \quad T_3(x, y, 0) = 0 \oplus (x \land y) = x \land y$$
	\end{itemize}
\end{proof}

This means that the Toffoli gate alone is enough to perform any classical and fully reversible computation.

But we do we need 3 inputs? It is easy to see that a 1-bit gate is definitely not enough to achieve classical reversibility. Our intuition would suggest that adding an \tit{ancilla} wire that keeps track of the original input should be able to solve this issue. However, the following holds.

\begin{framedthm}{Non-universality of classical 2-bit rev. logic}
	There exists a Boolean function that cannot be constructed from one and two bit reversible logic gates, and ancilla bits.
\end{framedthm}

\begin{proof}
	TODO \todo{todo?}
\end{proof}

This result concludes that the Toffoli gate cannot be improved any further. Therefore, from a classical viewpoint the construction presented in \cref{quantum toffoli} is remarkable: in quantum computing we can construct the Toffoli gate from one and two qubit gates, and since reversibility is an intrinsic property of quantum operators, the following holds.

Thus, in the end, is the set of quantum gates composed of $\{X, Y, Z, H, S, T, \mbox{CNOT}\}$ universal? Well, we recall that we initially pretended that the Pauli matrices allowed us to construct any rotation matrix, however unfortunately \underline{this is not true}.

TODO \todo{exact universality}
TODO \todo{approx universality}
